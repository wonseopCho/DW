{% extends 'base.html' %}
{% load static %}
{% load widget_tweaks %}
{% block content %}
<style>
body{
	padding-bottom: 0;
}
input[type=text], select {
    width: 100%;
    padding: 8px;
    display: inline-block;
    border: none;
    background: #f1f1f1;
}

input[type=text]:focus, select {
    background-color: #ddd;
    outline: none;
}

#submitbtn {
    background-color: #4CAF50;
    color: white;
    padding: 16px 20px;
    margin: 8px 0;
    border: none;
    cursor: pointer;
    width: 100%;
    opacity: 0.9;
    
}
label {
	font-weight: bold;
}

#edit_body {
  background-image: url("{% static 'images/south-korea.jpg' %}");
  background-position: center;
  background-repeat: no-repeat;
  background-size: cover;
}


</style>
<script>
function tipTitleCheckAjax(value) {
  var tip_title = {};
  tip_title.csrfmiddlewaretoken = '{{csrf_token}}';
  tip_title.title = value;
  if (value ==''){
    $('#id_title').text("");
    $('#id_title').css('background-color','#F1F1F1');
  }
  else if (value == '{{form.instance}}'){
  	$('#title_feeback_text').text('');
    $('#id_title').css('background-color', '#7CFFBB');
    $('#submitbtn').prop("disabled", false);
  }
  else {
      $.ajax({
        url:"{% url 'tips:title_check_ajax' %}",
        method:"post",
        data: tip_title,
        success: function(res){
          console.log(res)
          if (res == 1){
            $('#title_feeback_text').css('color', '#FF7878');
            $('#title_feeback_text').text('A article exists aleady with the title you have entered');
            $('#id_title').css('background-color', '#FF7878'); 
            $('#submitbtn').prop("disabled", true);
          }
          else {
            $('#title_feeback_text').text('');
            $('#id_title').css('background-color', '#7CFFBB');
            $('#submitbtn').prop("disabled", false);
          }
        },error: function(error){
          console.log("error",error);
        }
    }); 
  }
};

// function bs_input_file() {
//   $(".input-file").before(
//     function() {
//       if ( ! $(this).prev().hasClass('input-ghost') ) {
//         var element = $("<input type='file' class='input-ghost' style='visibility:hidden; height:0'>");
//         element.attr("name",$(this).attr("name"));
//         element.change(function(){
//           element.next(element).find('input').val((element.val()).split('\\').pop());
//         });
//         $(this).find("button.btn-choose").click(function(){
//           element.click();
//         });
//         $(this).find("button.btn-reset").click(function(){
//           element.val(null);
//           $(this).parents(".input-file").find('input').val('');
//         });
//         $(this).find('input').css("cursor","pointer");
//         $(this).find('input').mousedown(function() {
//           $(this).parents('.input-file').prev().click();
//           return false;
//         });
//         return element;
//       }
//     }
//   );
// }

$(document).ready(function(){
  // bs_input_file();
  $("#id_title").keyup(function(e){
    var value = $(this).val();
    console.log(value);
    tipTitleCheckAjax(value);
  });
});
</script>

<div id="edit_body" style="border:0px solid blue;padding:3px 0px 3px 0px;">
	<div style="border:0px solid red; border-radius:10px; width:95%; margin:0 auto; padding:5px; background-color: white">
		<span style="text-align:center"><h4>{{form.title.value}} Edit</h4></span>
		<form action="" enctype="multipart/form-data" method="POST">
			{% csrf_token %}
			<label for="id_category" style="width:100%; margin-bottom:0"><b>Category</b></label>
			{{form.category}}
			<label for="id_title" style="width:100%; margin-bottom:0"><b>Title</b></label><span id="title_feeback_text"></span>
			{{form.title}}
			<div class="form-group" style="border:0px solid red;margin-top:-25px;visibility:hidden; height:0">
        <div class="input-group input-file" name="video" id="id_video">
          <span class="input-group-btn">
            <button class="btn btn-primary btn-choose" type="button">Choose</button>
          </span>
          <input type="text" style="height:34px" class="form-control" placeholder='Choose a file...' />
          <span class="input-group-btn">
             <button class="btn btn-warning btn-reset" type="button">Reset</button>
          </span>
        </div>
      </div>
      <br>
      {{form.text}}
			<button id="submitbtn" type="submit" class="btn btn-default" style="width:100%">Submit</button>
		</form>
	</div>
</div>
<script>
  $('iframe').on('load', function(){
    setTimeout(function(){
    var aTag = `{{form.video.value}}`.split("/").pop(-1);
    $('iframe').contents().find('#_file').val(aTag);
    }, 500);
  });
</script>
{% endblock %}